name: Clean Old Files

on:
  schedule:
    - cron: '0 0 * * *' # Runs at midnight UTC every day

jobs:
  clean-files:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up Git
        run: |
         git config --global user.name "d5user"
         git config --global user.email "d5.softtradeinfotech@gmail.com"

      - name: Get commit date of files
        run: |
          # Get the list of files committed 3 days ago
          THREE_DAYS_AGO=$(date -d '3 days ago' --utc +%Y-%m-%dT%H:%M:%SZ)
          FILES_TO_DELETE=$(git log --since="$THREE_DAYS_AGO" --name-only --pretty=format: | sort -u)

          # Delete the files, excluding .github/workflows
          for file in $FILES_TO_DELETE; do
            if [ -f "$file" ] && [[ "$file" != .github/workflows/* ]]; then
              echo "Deleting $file"
              git rm "$file"
            else
              echo "Skipping $file (workflow file)"
            fi
          done

      - name: Commit changes
        run: |
          git commit -m "Delete files committed 3 days ago"
          git push origin HEAD
